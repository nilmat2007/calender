<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Event Slider</title>
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2ecc71;
      --background-color: #1a1a1a;
      --text-color: #ffffff;
      --card-background: #2c3e50;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .slider-container {
      position: relative;
      overflow: hidden;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .slider {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }

    .slide {
      flex: 0 0 100%;
      padding: 30px;
      background: var(--card-background);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .slide-content {
      max-width: 800px;
      width: 100%;
    }

    .slide h2 {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary-color);
    }

    .slide .date {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: var(--secondary-color);
    }

    .slide .details {
      font-size: 1.1rem;
      margin-bottom: 20px;
    }

    .slide img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      margin-top: 20px;
    }

    .controls {
      position: absolute;
      top: 50%;
      width: 100%;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
    }

    .controls button {
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 15px;
      cursor: pointer;
      font-size: 24px;
      transition: background-color 0.3s ease;
      border-radius: 50%;
    }

    .controls button:hover {
      background-color: rgba(255, 255, 255, 0.4);
    }

    .events-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    .event-card {
      background: var(--card-background);
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .event-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .event-card h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--primary-color);
    }

    .event-card .date {
      font-size: 1rem;
      color: var(--secondary-color);
      margin-bottom: 10px;
    }

    .event-card .details {
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .slide {
        padding: 20px;
      }

      .slide h2 {
        font-size: 2rem;
      }

      .events-list {
        flex-direction: column;
        align-items: center;
      }

      .event-card {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="slider-container">
      <div class="slider" id="slider"></div>
      <div class="controls">
        <button onclick="changeSlide(-1)">❮</button>
        <button onclick="changeSlide(1)">❯</button>
      </div>
    </div>
    <div class="events-list" id="eventsList"></div>
  </div>

  <script>
    let currentSlide = 0;
    let eventData = [];

    function fetchData() {
      fetch('https://script.google.com/macros/s/AKfycbziJEkqg_ybK0ioco5120m5591wZ7EcsM0Bu7op3UYKH-gCQdtmF3EO3tCqJrKBK5x9/exec')
        .then(response => response.json())
        .then(data => {
          eventData = data;
          renderSlider();
          renderEventsList();
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          document.getElementById('slider').innerHTML = '<p>Error loading events. Please try again later.</p>';
        });
    }

    function renderSlider() {
      const slider = document.getElementById('slider');
      slider.innerHTML = '';

      eventData.forEach((item, index) => {
        const slide = document.createElement('div');
        slide.classList.add('slide');
        slide.innerHTML = `
          <div class="slide-content">
            <h2>${item.event}</h2>
            <p class="date">${formatDate(item.date)}</p>
            <p class="details">${item.details}</p>
            ${item.image ? `<img src="${item.image}" alt="${item.event}" loading="lazy">` : ''}
          </div>
        `;
        slider.appendChild(slide);
      });

      updateSlidePosition();
    }

    function renderEventsList() {
      const eventsList = document.getElementById('eventsList');
      eventsList.innerHTML = '';

      eventData.forEach((item, index) => {
        const eventCard = document.createElement('div');
        eventCard.classList.add('event-card');
        eventCard.innerHTML = `
          <h3>${item.event}</h3>
          <p class="date">${formatDate(item.date)}</p>
          <p class="details">${truncateText(item.details, 100)}</p>
        `;
        eventCard.addEventListener('click', () => {
          currentSlide = index;
          updateSlidePosition();
        });
        eventsList.appendChild(eventCard);
      });
    }

    function updateSlidePosition() {
      const slider = document.getElementById('slider');
      slider.style.transform = `translateX(${-currentSlide * 100}%)`;
    }

    function changeSlide(direction) {
      currentSlide = (currentSlide + direction + eventData.length) % eventData.length;
      updateSlidePosition();
    }

    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('th-TH', options);
    }

    function truncateText(text, maxLength) {
      return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }

    document.addEventListener('DOMContentLoaded', fetchData);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') changeSlide(-1);
      if (e.key === 'ArrowRight') changeSlide(1);
    });

    // Touch support
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, false);

    document.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, false);

    function handleSwipe() {
      if (touchEndX < touchStartX) changeSlide(1);
      if (touchEndX > touchStartX) changeSlide(-1);
    }
  </script>
</body>
</html>
